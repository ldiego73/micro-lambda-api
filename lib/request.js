"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiRequest=void 0;const querystring_1=__importDefault(require("querystring")),http_1=require("./http"),utils_1=require("./utils");class ApiRequest{constructor(t,e){var s,r,i,h,o;this._query={},this._params={},this._headers={};const n=t.requestContext||{},{isBase64Encoded:a}=t,d=n.stage||"",u=n.resourcePath||n.routeKey;let _=t.path||t.rawPath||"/";if(d&&u&&0===_.indexOf(`/${d}/`)&&0!==u.indexOf(`/${d}/`)&&(_=_.substring(d.length+1)),_=utils_1.normalizePath(_),this._id=e.awsRequestId||n.requestId,this._stage="$default"===d?"":d,this._method=t.httpMethod||(null===(s=n.http)||void 0===s?void 0:s.method)||n.httpMethod||http_1.HttpMethod.GET,this._path=_,this._query=Object.assign({},t.queryStringParameters),t.headers){for(const e in t.headers)this._headers[e.toLowerCase()]=t.headers[e];this._headers["x-request-id"]=this._id}const p=a?Buffer.from(t.body||"","base64").toString():t.body;this._headers["content-type"]&&this._headers["content-type"].includes("application/x-www-form-urlencoded")?this._body=querystring_1.default.parse(p):this._body="object"==typeof p?p:utils_1.parseBody(p),this._host=this._headers.host||n.domainName;const g=this._headers["x-forwarded-for"]||(null===(r=n.http)||void 0===r?void 0:r.sourceIp)||(null===(i=n.identity)||void 0===i?void 0:i.sourceIp)||"";this._ip=g.split(",")[0].trim(),this._userAgent=this._headers["user-agent"]||(null===(h=n.http)||void 0===h?void 0:h.userAgent)||(null===(o=n.identity)||void 0===o?void 0:o.userAgent)||"",this._proxyIntegration=n.elb?http_1.HttpIntegration.ALB:"2.0"===t.version?http_1.HttpIntegration.APIGW_HTTP_API:http_1.HttpIntegration.APIGW_REST_API,this._isBase64Encoded=a}get id(){return this._id}get stage(){return this._stage}get method(){return this._method}get path(){return this._path}get query(){return this._query}get params(){return this._params}set params(t){this._params=t}get headers(){return this._headers}get body(){return this._body}get host(){return this._host}get ip(){return this._ip}get userAgent(){return this._userAgent}get proxyIntegration(){return this._proxyIntegration}get isBase64Encoded(){return this._isBase64Encoded}}exports.ApiRequest=ApiRequest;