"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiRequest=void 0;const querystring_1=__importDefault(require("querystring")),http_1=require("./http"),logger_1=require("./logger"),utils_1=require("./utils");class ApiRequest{constructor(e,t){var r,s,i,o,u;this.log=logger_1.Logger.create();const n=e.requestContext||{},{isBase64Encoded:a}=e,d=n.stage||"",h=n.resourcePath||n.routeKey;let p=e.path||e.rawPath||"/";d&&h&&0===p.indexOf(`/${d}/`)&&0!==h.indexOf(`/${d}/`)&&(p=p.substring(d.length+1)),p=utils_1.normalizePath(p);const g=t.awsRequestId||n.requestId,_="$default"===d?"":d,l=e.httpMethod||(null===(r=n.http)||void 0===r?void 0:r.method)||n.httpMethod||http_1.HttpMethod.GET,q=Object.assign({},e.queryStringParameters),c={};if(e.headers){for(const t in e.headers)c[t.toLowerCase()]=e.headers[t];c["x-request-id"]=g}const y=a?Buffer.from(e.body||"","base64").toString():e.body;let f;f=c["content-type"]&&c["content-type"].includes("application/x-www-form-urlencoded")?querystring_1.default.parse(y):"object"==typeof y?y:utils_1.parseBody(y);const m=c.host||n.domainName,v=(c["x-forwarded-for"]||(null===(s=n.http)||void 0===s?void 0:s.sourceIp)||(null===(i=n.identity)||void 0===i?void 0:i.sourceIp)||"").split(",")[0].trim(),A=c["user-agent"]||(null===(o=n.http)||void 0===o?void 0:o.userAgent)||(null===(u=n.identity)||void 0===u?void 0:u.userAgent)||"",I=n.elb?http_1.HttpIntegration.ALB:"2.0"===e.version?http_1.HttpIntegration.APIGW_HTTP_API:http_1.HttpIntegration.APIGW_REST_API;this._request={id:g,stage:_,method:l,path:p,query:q,headers:c,body:f,host:m,ip:v,userAgent:A,proxyIntegration:I,isBase64Encoded:a}}get id(){return this._request.id}get stage(){return this._request.stage}get method(){return this._request.method}get path(){return this._request.path}get query(){return this._request.query}get params(){return this._request.params||{}}set params(e){this._request.params=e}get headers(){return this._request.headers}get body(){return this._request.body}get host(){return this._request.host}get ip(){return this._request.ip}get userAgent(){return this._request.userAgent}get proxyIntegration(){return this._request.proxyIntegration}get isBase64Encoded(){return this._request.isBase64Encoded}toRequest(){return this._request||{}}}exports.ApiRequest=ApiRequest;