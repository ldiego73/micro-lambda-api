"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiResponse=void 0;const errors_1=require("./errors"),http_1=require("./http");class ApiResponse{constructor(e){this.request=e,this.statusCode=http_1.HttpStatus.OK,this.headers=Object.assign({},null==e?void 0:e.headers)}status(e){return this.statusCode=e,this}header(e,s){return this.headers[e.toLowerCase()]=s,this}setDefaultCors(e,s,t){this.headers["Access-Control-Allow-Origin"]=e||http_1.HttpHeadersCors.ORIGIN,this.headers["Access-Control-Allow-Methods"]=s||http_1.HttpHeadersCors.METHODS,this.headers["Access-Control-Allow-Headers"]=t||http_1.HttpHeadersCors.HEADERS}getDefaultCors(){return[this.headers["Access-Control-Allow-Origin"],this.headers["Access-Control-Allow-Methods"],this.headers["Access-Control-Allow-Headers"]]}cors(e){const s=e||{},[t,r,o]=this.getDefaultCors();return this.setDefaultCors(s.origin||t,s.methods||r,s.headers||o),s.credentials&&(this.headers["Access-Control-Allow-Credentials"]="true"),s.exposeHeaders&&(this.headers["Access-Control-Expose-Headers"]=s.exposeHeaders),s.maxAge&&!isNaN(s.maxAge)&&(this.headers["Access-Control-Max-Age"]=(s.maxAge/1e3|0).toString()),this}getResponse(){return this.response}send(e,s=!1){var t,r;let o="";if(void 0!==e&&(o="string"!=typeof e?JSON.stringify(e):e),ApiResponse.cors){const[e,s,t]=this.getDefaultCors();this.setDefaultCors(e,s,t)}ApiResponse.credentials&&(this.headers["Access-Control-Allow-Credentials"]="true");const i={isBase64Encoded:!s&&((null===(t=this.request)||void 0===t?void 0:t.isBase64Encoded)||!1),statusCode:this.statusCode,body:o,headers:this.headers};return(null===(r=this.request)||void 0===r?void 0:r.proxyIntegration)===http_1.HttpIntegration.ALB&&(i.statusDescription=`${this.statusCode} ${http_1.HttpStatus[this.statusCode]}`),this.response=i,i}json(e){return this.header("content-type",http_1.HttpContentTypes.JSON).send(e)}html(e){return this.header("content-type",http_1.HttpContentTypes.HTML).send(e)}file(e){return this.header("content-type",http_1.HttpContentTypes.BINARY).send(e)}error(e){var s;return"string"==typeof e?this.send({code:errors_1.ApiError.GENERIC_ERROR,message:e,status:http_1.HttpStatus.INTERNAL_SERVER_ERROR}):this.send({status:e.status,code:e.code,message:e.message,...null!==(s=e.data)&&void 0!==s?s:{}},!0)}}exports.ApiResponse=ApiResponse,ApiResponse.cors=!1,ApiResponse.credentials=!1;