"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiResponse=void 0;const errors_1=require("./errors"),http_1=require("./http");class ApiResponse{constructor(e){this.request=e,this.statusCode=http_1.HttpStatus.OK,this.headers={"content-type":"application/json"},e&&e.headers["x-request-id"]&&(this.headers["x-request-id"]=e.headers["x-request-id"])}status(e){return this.statusCode=e,this}header(e,t){return this.headers[e.toLowerCase()]=t,this}setDefaultCors(e,t,s){this.headers["Access-Control-Allow-Origin"]=e||http_1.HttpHeadersCors.ORIGIN,this.headers["Access-Control-Allow-Methods"]=t||http_1.HttpHeadersCors.METHODS,this.headers["Access-Control-Allow-Headers"]=s||http_1.HttpHeadersCors.HEADERS}getDefaultCors(){return[this.headers["Access-Control-Allow-Origin"],this.headers["Access-Control-Allow-Methods"],this.headers["Access-Control-Allow-Headers"]]}cors(e){const t=e||{},[s,r,o]=this.getDefaultCors();return this.setDefaultCors(t.origin||s,t.methods||r,t.headers||o),t.credentials&&(this.headers["Access-Control-Allow-Credentials"]="true"),t.exposeHeaders&&(this.headers["Access-Control-Expose-Headers"]=t.exposeHeaders),t.maxAge&&!isNaN(t.maxAge)&&(this.headers["Access-Control-Max-Age"]=(t.maxAge/1e3|0).toString()),this}toResponse(){return this._response}toResponseError(){return this._error}send(e,t=!1){var s,r;let o="";if(void 0!==e&&(o="string"!=typeof e?JSON.stringify(e):e),ApiResponse.cors){const[e,t,s]=this.getDefaultCors();this.setDefaultCors(e,t,s)}ApiResponse.credentials&&(this.headers["Access-Control-Allow-Credentials"]="true");const i={isBase64Encoded:!t&&((null===(s=this.request)||void 0===s?void 0:s.isBase64Encoded)||!1),statusCode:this.statusCode,body:o,headers:this.headers};return(null===(r=this.request)||void 0===r?void 0:r.proxyIntegration)===http_1.HttpIntegration.ALB&&(i.statusDescription=`${this.statusCode} ${http_1.HttpStatus[this.statusCode]}`),this._response=i,i}json(e){return this.header("content-type",http_1.HttpContentTypes.JSON).send(e)}html(e){return this.header("content-type",http_1.HttpContentTypes.HTML).send(e)}file(e){return this.header("content-type",http_1.HttpContentTypes.BINARY).send(e)}error(e){var t;return this._error="string"==typeof e?{status:http_1.HttpStatus.INTERNAL_SERVER_ERROR,code:errors_1.ApiError.GENERIC_ERROR,message:e}:{status:e.status,code:e.code,message:e.message,...null!==(t=e.data)&&void 0!==t?t:{}},this.send(this._error,!0)}}exports.ApiResponse=ApiResponse,ApiResponse.cors=!1,ApiResponse.credentials=!1;